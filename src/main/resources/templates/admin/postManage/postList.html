<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="admin/fragment/adminStaticFragment :: head"/>
    <link rel="stylesheet" th:href="@{/css/profile.css}">
    <title>Spur - A Bootstrap Admin Template</title>
    <style>
        body {
            overflow-x: hidden;
        }
    </style>
</head>

<body>
<div class="dash">
    <th:block th:replace="/admin/fragment/adminComponent :: sideBar"/>

    <div class="dash-app">
        <th:block th:replace="/admin/fragment/adminComponent :: toolbar"/>
        <div class="row mt-3">

            <div class="col-8 offset-2">
                <div class="card spur-card">
                    <div class="card-header">
                        <div class="spur-card-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="spur-card-title"> 검색 </div>
                    </div>
                    <div class="card-body ">
                        <form method="get" th:action>
                            <div class="form-group">
                                <label for="searchValue">검색어</label>
                                <input class="form-control" id="searchValue" name="searchValue" placeholder="검색어를 입력해주세요" type="text">
                            </div>
                            <div class="form-group">
                                <label for="searchField">Example select</label>
                                <select class="form-control" id="searchField" name="filed">
                                    <option th:each="filed : ${T(com.example.community.admin.postManage.spec.SearchFiled).values()}" th:text="${filed.value}">1</option>
                                </select>
                            </div>
                            <div class="d-flex flex-row justify-content-between">
                                <button class="btn btn-info" id="searchReset" type="button">초기화</button>
                                <button class="btn btn-primary" type="submit">검색</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>



            <div class="col-10 offset-1">
                <table class="table table-hover p-5">
                    <thead>
                    <tr>
                        <th scope="col">IDX</th>
                        <th scope="col">이메일</th>
                        <th scope="col">작성일</th>
                        <th scope="col">제목</th>
                        <th scope="col">내용</th>
                        <th scope="col">삭제</th>

                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="post : ${postList.dataList}">
                        <th th:text="${post.id}"></th>
                        <th th:text="${post.email}"></th>
                        <th th:text="${#temporals.format(post.createdAt,'yyyy-MM-dd')}"></th>
                        <th th:text="${post.title}"></th>
                        <th>
                            <a class="d-inline-block text-truncate" style="max-width: 150px;" th:href="@{/post/{id}(id=${post.id})}" th:text="${post.content}"/>
                        </th>
                        <th><a class="text-danger" style="cursor: pointer" th:data-id="${post.id}">삭제</a></th>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-3 offset-5 mt-4">
                <nav aria-label="Page navigation" class="mt-3"
                     th:with="startPage = ${postList.startPage}, endPage = ${postList.endPage}, filed = ${searchParam?.searchFiled?.getValue() ?: null} ,value = ${searchParam?.searchValue ?: ''} ">
                    <ul class="pagination">
                        <li class="page-item" th:classappend="${postList.existPrevPage ? '' : 'disabled'}">
                            <a aria-label="Previous" class="page-link" th:href="@{/admin/postList(page=${postList.startPage - 5}, filed=${filed}, searchValue=${value})}">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>

                        <li class="page-item" th:classappend="${postList.currentPage == page ? 'active' : ''}"
                            th:each="page: ${#numbers.sequence(startPage, endPage)}">
                            <a class="page-link" th:href="@{/admin/postList/(page=${page} ,filed=${filed}, searchValue=${value})}" th:text="${page}"></a>
                        </li>

                        <li class="page-item" th:classappend="${postList.existNextPage ? '' : 'disabled'}">
                            <a aria-label="Next" class="page-link" th:href="@{/admin/postList(page=${postList.startPage + 5},filed=${filed}, searchValue=${value})}">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>


        </div>

    </div>
</div>
<th:block th:replace="admin/fragment/adminStaticFragment :: script"/>
<script>
    document.querySelector("#searchReset").addEventListener("click",() => {
        window.location.href = location.pathname
    })
    document.querySelectorAll("a[data-id]").forEach(elem => {
        elem.addEventListener("click",function (e) {
            const {id} =  e.target.dataset


            fetch("/admin/postDelete",{
                method: "POST",
                body: new URLSearchParams({
                    id
                })
            }).then(res => res.url)
                .then(url => location.href = url)
                .catch(reason => alert(reason))
        })
    })
</script>
</body>

</html>